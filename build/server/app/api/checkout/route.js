"use strict";(()=>{var e={};e.id=607,e.ids=[607],e.modules={67096:e=>{e.exports=require("bcrypt")},38013:e=>{e.exports=require("mongodb")},11185:e=>{e.exports=require("mongoose")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},32081:e=>{e.exports=require("child_process")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},17791:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>v,requestAsyncStorage:()=>y,routeModule:()=>x,serverHooks:()=>_,staticGenerationAsyncStorage:()=>S});var i={};r.r(i),r.d(i,{POST:()=>g});var s=r(49303),n=r(88716),a=r(60670),o=r(68266),p=r(16287),c=r(59702),d=r(11185),u=r.n(d),l=r(75571);let m=r(4687)(process.env.STRIPE_SK);async function g(e){u().connect(process.env.MONGO_URL);let{cartProducts:t,address:r}=await e.json(),i=await (0,l.getServerSession)(o.L),s=i?.user?.email,n=await c.K.create({userEmail:s,...r,cartProducts:t,paid:!1}),a=[];for(let e of t){let t=await p.s.findById(e._id),r=t.basePrice;if(e.size&&(r+=t.sizes.find(t=>t._id.toString()===e.size._id.toString()).price),e.extras?.length>0)for(let i of e.extras)r+=t.extraIngredientPrices.find(e=>e._id.toString()===i._id.toString()).price;let i=e.name;a.push({quantity:1,price_data:{currency:"USD",product_data:{name:i},unit_amount:100*r}})}let d=await m.checkout.sessions.create({line_items:a,mode:"payment",customer_email:s,success_url:process.env.NEXTAUTH_URL+"orders/"+n._id.toString()+"?clear-cart=1",cancel_url:process.env.NEXTAUTH_URL+"cart?canceled=1",metadata:{orderId:n._id.toString()},payment_intent_data:{metadata:{orderId:n._id.toString()}},shipping_options:[{shipping_rate_data:{display_name:"Delivery fee",type:"fixed_amount",fixed_amount:{amount:500,currency:"USD"}}}]});return Response.json(d.url)}let x=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/checkout/route",pathname:"/api/checkout",filename:"route",bundlePath:"app/api/checkout/route"},resolvedPagePath:"/home/uumparcelcentre.com.my/firdausfauzi/src/app/api/checkout/route.js",nextConfigOutput:"",userland:i}),{requestAsyncStorage:y,staticGenerationAsyncStorage:S,serverHooks:_}=x,h="/api/checkout/route";function v(){return(0,a.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:S})}},68266:(e,t,r)=>{let i;r.d(t,{L:()=>l});let{MongoClient:s}=r(38013);if(!process.env.MONGO_URL)throw Error('Invalid/Missing environment variable: "MONGODB_URI"');i=new s(process.env.MONGO_URL,{}).connect();var n=r(6590),a=r(53797),o=r(77234),p=r(64704),c=r(67096),d=r.n(c),u=r(11185);let l={secret:process.env.SECRET,adapter:(0,p.dJ)(i),providers:[(0,o.Z)({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET}),(0,a.Z)({name:"Credentials",id:"credentials",credentials:{email:{label:"Email",type:"email",placeholder:"test@example.com"},password:{label:"Password",type:"password"}},async authorize(e){let t=e?.email,r=e?.password;u.connect(process.env.MONGO_URL);let i=await n.n.findOne({email:t});return i&&d().compareSync(r,i.password)?i:null}})]}},16287:(e,t,r)=>{r.d(t,{s:()=>o});var i=r(11185),s=r.n(i);let n=new i.Schema({name:String,price:Number}),a=new i.Schema({image:{type:String},name:{type:String},description:{type:String},category:{type:s().Types.ObjectId},basePrice:{type:Number},sizes:{type:[n]},extraIngredientPrices:{type:[n]}},{timestamps:!0}),o=i.models?.MenuItem||(0,i.model)("MenuItem",a)},59702:(e,t,r)=>{r.d(t,{K:()=>n});var i=r(11185);let s=new i.Schema({userEmail:String,phone:String,streetAddress:String,postalCode:String,city:String,country:String,cartProducts:Object,paid:{type:Boolean,default:!1}},{timestamps:!0}),n=i.models?.Order||(0,i.model)("Order",s)},6590:(e,t,r)=>{r.d(t,{n:()=>n});var i=r(11185);let s=new i.Schema({name:{type:String},email:{type:String,required:!0,unique:!0},password:{type:String},image:{type:String}},{timestamps:!0}),n=i.models?.User||(0,i.model)("User",s)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[948,51,687],()=>r(17791));module.exports=i})();