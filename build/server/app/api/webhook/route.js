"use strict";(()=>{var e={};e.id=570,e.ids=[570],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32081:e=>{e.exports=require("child_process")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},73837:e=>{e.exports=require("util")},46969:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>g,requestAsyncStorage:()=>c,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>l});var o={};r.r(o),r.d(o,{POST:()=>u});var s=r(49303),a=r(88716),i=r(60670),n=r(59702);let p=r(4687)(process.env.STRIPE_SK);async function u(e){let t;let r=e.headers.get("stripe-signature");try{let o=await e.text(),s=process.env.STRIPE_SIGN_SECRET;t=p.webhooks.constructEvent(o,r,s)}catch(e){return console.error("stripe error"),console.log(e),Response.json(e,{status:400})}if("checkout.session.completed"===t.type){console.log(t);let e=t?.data?.object?.metadata?.orderId;t?.data?.object?.payment_status==="paid"&&await n.K.updateOne({_id:e},{paid:!0})}return Response.json("ok",{status:200})}let d=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/webhook/route",pathname:"/api/webhook",filename:"route",bundlePath:"app/api/webhook/route"},resolvedPagePath:"/home/uumparcelcentre.com.my/firdausfauzi/src/app/api/webhook/route.js",nextConfigOutput:"",userland:o}),{requestAsyncStorage:c,staticGenerationAsyncStorage:l,serverHooks:m}=d,h="/api/webhook/route";function g(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:l})}},49303:(e,t,r)=>{e.exports=r(30517)},59702:(e,t,r)=>{r.d(t,{K:()=>a});var o=r(11185);let s=new o.Schema({userEmail:String,phone:String,streetAddress:String,postalCode:String,city:String,country:String,cartProducts:Object,paid:{type:Boolean,default:!1}},{timestamps:!0}),a=o.models?.Order||(0,o.model)("Order",s)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[948,687],()=>r(46969));module.exports=o})();